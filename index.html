<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIGSTICK Input Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 5px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        header {
            background-color: #3498db;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 5px 5px 0 0;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: white;
        }
        .card-header {
            background-color: #f3f3f3;
            padding: 10px 15px;
            margin: -15px -15px 15px -15px;
            border-bottom: 1px solid #ddd;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.generate-btn {
            background-color: #27ae60;
            font-size: 18px;
            padding: 12px 24px;
            margin: 20px 0;
            display: block;
            width: 100%;
        }
        button.generate-btn:hover {
            background-color: #219653;
        }
        .help-text {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .info-box {
            background-color: #edf7ff;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        .example-box {
            background-color: #f0f7f0;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        .warning-box {
            background-color: #fff4e5;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        .radio-group {
            margin-bottom: 10px;
        }
        .radio-group input[type="radio"] {
            margin-right: 10px;
        }
        .checkbox-group {
            margin-bottom: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
        }
        .code-block {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted black;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .section-navigation {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            background-color: #f5f5f5;
            border-top: 1px solid #ddd;
        }
        .tab-navigation {
            display: flex;
            overflow-x: auto;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            padding: 10px 20px;
            background-color: #f3f3f3;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: bold;
            white-space: nowrap;
        }
        .tab-button.active {
            border-bottom: 3px solid #3498db;
            background-color: white;
        }
        .tab-section {
            display: none;
        }
        .tab-section.active {
            display: block;
        }
        .input-preview {
            border: 2px solid #27ae60;
            border-radius: 5px;
            padding: 20px;
            background-color: #f9fffc;
            margin-top: 20px;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .action-buttons button, .action-buttons a {
            margin: 0 10px;
            padding: 10px 20px;
            width: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>BIGSTICK Input Generator</h1>
        <p>Create input files for BIGSTICK nuclear shell-model calculations</p>
    </header>

    <div class="container">
        <div class="info-box">
            <h3>Welcome to the BIGSTICK Input Generator</h3>
            <p>This web interface helps you create input files for BIGSTICK, a configuration-interaction shell-model code for nuclear physics calculations. Even if you've never used BIGSTICK before, this tool will guide you through the process step by step.</p>
            <p>Follow the tabs below to set up your calculation parameters, then generate an input file that you can download and use with BIGSTICK.</p>
        </div>

        <div class="tab-navigation">
            <button class="tab-button active" data-tab="introduction">Introduction</button>
            <button class="tab-button" data-tab="model-space">Model Space</button>
            <button class="tab-button" data-tab="interactions">Interactions</button>
            <button class="tab-button" data-tab="run-options">Run Options</button>
            <button class="tab-button" data-tab="diagonalization">Diagonalization</button>
            <button class="tab-button" data-tab="input-file">Input File</button>
        </div>

        <!-- Introduction Tab -->
        <div id="introduction" class="tab-section active">
            <h2>Introduction to BIGSTICK</h2>
            
            <div class="card">
                <div class="card-header">What is BIGSTICK?</div>
                <p>BIGSTICK is a configuration-interaction (CI) shell-model code for nuclear physics calculations. It solves the many-body Schrödinger equation for atomic nuclei, calculating properties such as energy levels, electromagnetic transitions, and other observables.</p>
                
                <p>Some key capabilities of BIGSTICK include:</p>
                <ul>
                    <li>Compute low-lying energy spectra of nuclei</li>
                    <li>Calculate angular momentum and isospin quantum numbers</li>
                    <li>Generate nuclear wave functions</li>
                    <li>Compute one-body densities and transition strengths</li>
                    <li>Support for both "conventional" shell model (with a core) and "no-core" shell model calculations</li>
                </ul>
            </div>
            
            <div class="card">
                <div class="card-header">How to Use This Generator</div>
                <p>This web tool helps you create input files for BIGSTICK without needing to understand all the technical details. Just follow these steps:</p>
                <ol>
                    <li><strong>Navigate through the tabs</strong> at the top to fill in required parameters</li>
                    <li><strong>Fill out the form fields</strong> in each section (default values are provided for beginners)</li>
                    <li><strong>Generate your input file</strong> in the final tab</li>
                    <li><strong>Download the input file</strong> to use with BIGSTICK</li>
                </ol>
                <p>The input generator will create a text file that can be used with the command:</p>
                <code>bigstick.x < your_input_file.txt</code>
            </div>
            
            <div class="example-box">
                <h3>Example: 24Mg Calculation</h3>
                <p>Throughout this guide, we'll use a simple example of calculating energy levels for 24Mg in the sd shell as a reference. 24Mg has 12 protons and 12 neutrons, but assuming a 16O core (8 protons, 8 neutrons), we'll work with 4 valence protons and 4 valence neutrons.</p>
            </div>
            
            <div class="section-navigation">
                <div></div>
                <button class="next-tab-btn" data-next="model-space">Next: Define Model Space</button>
            </div>
        </div>

        <!-- Model Space Tab -->
        <div id="model-space" class="tab-section">
            <h2>Define Model Space</h2>
            <p>The model space defines which nucleons and orbitals are included in your calculation.</p>
            
            <div class="card">
                <div class="card-header">Single-Particle Space</div>
                <div class="form-group">
                    <label for="spsFileChoice">Select single-particle space:</label>
                    <select id="spsFileChoice">
                        <option value="sd">sd shell (0d5/2, 0d3/2, 1s1/2)</option>
                        <option value="pf">pf shell (0f7/2, 0f5/2, 1p3/2, 1p1/2)</option>
                        <option value="fpd">fp+d5/2 shell</option>
                        <option value="sdpf">sd+pf shell</option>
                        <option value="auto">Auto-generate (for no-core shell model)</option>
                    </select>
                    <div class="help-text">
                        <p>This defines the single-particle orbits available to your valence nucleons.</p>
                        <p>For beginners, the "sd shell" is recommended for lighter nuclei (mass numbers around 20-36).</p>
                    </div>
                </div>

                <div id="autoOptions" style="display: none;">
                    <div class="form-group">
                        <label for="maxN">Maximum principal quantum number N:</label>
                        <input type="number" id="maxN" min="0" max="10" value="4">
                        <p class="help-text">For no-core shell model, specify the maximum orbital quantum number (0 for 0s, 1 for 0p, 2 for sd, etc.)</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Valence Particles</div>
                <div class="example-box">
                    <p><strong>Example:</strong> For 24Mg with an 16O core, we use 4 valence protons and 4 valence neutrons.</p>
                </div>
                
                <div class="form-group">
                    <label for="nucleus">Common Nuclei:</label>
                    <select id="nucleus">
                        <option value="custom">Custom configuration</option>
                        <option value="mg24" selected>24Mg (sd shell, 4p 4n)</option>
                        <option value="si28">28Si (sd shell, 6p 6n)</option>
                        <option value="s32">32S (sd shell, 8p 8n)</option>
                        <option value="ca40">40Ca (sd shell, 12p 12n)</option>
                        <option value="ca48">48Ca (pf shell, 0p 8n)</option>
                        <option value="ti46">46Ti (pf shell, 2p 4n)</option>
                        <option value="fe56">56Fe (pf shell, 6p 10n)</option>
                        <option value="ni56">56Ni (pf shell, 8p 8n)</option>
                    </select>
                    <p class="help-text">Select a common nucleus to automatically set valence particles, or choose "Custom configuration" to set them manually.</p>
                </div>
                
                <div class="form-group">
                    <label for="valenceProtons">Number of valence protons:</label>
                    <input type="number" id="valenceProtons" min="-20" max="50" value="4">
                    <div class="help-text">
                        <p>For standard shell model: Count only valence protons above the core.</p>
                        <p>For negative values: Will use particle-hole conjugation (advanced option).</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="valenceNeutrons">Number of valence neutrons:</label>
                    <input type="number" id="valenceNeutrons" min="-20" max="50" value="4">
                    <div class="help-text">
                        <p>For standard shell model: Count only valence neutrons above the core.</p>
                        <p>For negative values: Will use particle-hole conjugation (advanced option).</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Quantum Numbers</div>
                <div class="example-box">
                    <p><strong>Example:</strong> For even-even nuclei like 24Mg, we typically use 2×Jz = 0 and positive parity.</p>
                </div>
                
                <div class="form-group">
                    <label for="jzValue">2 × Jz value:</label>
                    <input type="number" id="jzValue" min="-20" max="20" step="1" value="0">
                    <div class="help-text">
                        <p>BIGSTICK uses an M-scheme basis with fixed Jz. Enter twice the value of Jz.</p>
                        <p>For even number of particles: Usually 0</p>
                        <p>For odd number of particles: Enter an odd integer, typically ±1</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Parity:</label>
                    <div class="radio-group">
                        <input type="radio" id="parityPlus" name="parity" value="+" checked>
                        <label for="parityPlus">Positive (+)</label>
                    </div>
                    <div class="radio-group">
                        <input type="radio" id="parityMinus" name="parity" value="-">
                        <label for="parityMinus">Negative (-)</label>
                    </div>
                    <div class="radio-group">
                        <input type="radio" id="parityBoth" name="parity" value="0">
                        <label for="parityBoth">Both (0)</label>
                    </div>
                    <p class="help-text">Select the parity of states to include. Choose "Both" only if you need to compute parity-changing transitions.</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Truncation Options</div>
                <div class="warning-box">
                    <p>For beginners, it's recommended to leave truncation off (select "No" below) unless you know your calculation will be too large to handle.</p>
                </div>
                
                <div class="form-group">
                    <label for="truncateOption">Would you like to truncate the many-body space?</label>
                    <div class="radio-group">
                        <input type="radio" id="truncateYes" name="truncate" value="y">
                        <label for="truncateYes">Yes</label>
                    </div>
                    <div class="radio-group">
                        <input type="radio" id="truncateNo" name="truncate" value="n" checked>
                        <label for="truncateNo">No</label>
                    </div>
                    <div class="help-text">
                        <p>Truncation reduces the computational burden by restricting the many-body space.</p>
                        <p>Only needed for large calculations that exceed memory limits.</p>
                    </div>
                </div>

                <div id="truncationOptions" style="display: none;">
                    <div class="form-group">
                        <label for="maxExcite">Maximum excitation:</label>
                        <input type="number" id="maxExcite" min="0" max="20" value="2">
                        <p class="help-text">Enter the maximum excitation level allowed. This limits the total W of states.</p>
                    </div>
                </div>
            </div>

            <div class="section-navigation">
                <button class="prev-tab-btn" data-prev="introduction">Previous: Introduction</button>
                <button class="next-tab-btn" data-next="interactions">Next: Set Interactions</button>
            </div>
        </div>

        <!-- Interactions Tab -->
        <div id="interactions" class="tab-section">
            <h2>Set Interactions</h2>
            <p>The interaction defines the nuclear forces between nucleons in your calculation.</p>
            
            <div class="example-box">
                <p><strong>Example:</strong> For 24Mg in the sd shell, we typically use the USDB interaction.</p>
            </div>
            
            <div class="card">
                <div class="card-header">Interaction Files</div>
                <div class="form-group">
                    <label for="intFile">Select interaction:</label>
                    <select id="intFile">
                        <option value="usdb" selected>USDB (USD Brown, for sd shell)</option>
                        <option value="usda">USDA (USD Alternative, for sd shell)</option>
                        <option value="gxpf1a">GXPF1A (for pf shell)</option>
                        <option value="kb3g">KB3G (Kuo-Brown, for pf shell)</option>
                        <option value="nn3lo">NN3LO (for no-core shell model)</option>
                    </select>
                    <div class="help-text">
                        <p>Select the nuclear interaction appropriate for your chosen model space.</p>
                        <p>For the sd shell, USDB is a well-established choice.</p>
                        <p>For the pf shell, GXPF1A and KB3G are commonly used.</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Scaling Parameters</div>
                <div class="example-box">
                    <p><strong>Example:</strong> For 24Mg with the USDB interaction (fit to A=18), we use A₀=18, A=24, and exponent 0.3</p>
                </div>
                
                <div class="form-group">
                    <label for="scaleA">Single-particle energy scaling (A):</label>
                    <input type="number" id="scaleA" min="0" step="0.1" value="1.0">
                    <p class="help-text">Usually set to 1.0 (no scaling) for single-particle energies</p>
                </div>
                
                <div class="form-group">
                    <label for="scaleB">Reference mass number (A₀):</label>
                    <input type="number" id="scaleB" min="0" step="1" value="18">
                    <p class="help-text">Reference mass number used when the interaction was fit (usually A of core + 2)</p>
                    <ul>
                        <li>For sd-shell (USDA/B): Use 18 (16O core + 2)</li>
                        <li>For pf-shell (GXPF1A, KB3G): Use 42 (40Ca core + 2)</li>
                        <li>For no scaling: Use same value as target mass</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="targetA">Target mass number (A):</label>
                    <input type="number" id="targetA" min="0" step="1" value="24">
                    <p class="help-text">Mass number of the nucleus being calculated (protons + neutrons)</p>
                </div>
                
                <div class="form-group">
                    <label for="scaleX">Scaling exponent (X):</label>
                    <input type="number" id="scaleX" min="0" max="1" step="0.01" value="0.3">
                    <p class="help-text">Scaling follows (A₀/A)^X. Typically 0.3 for USD interactions and 0.3-0.5 for KB3/GXPF1.</p>
                </div>
                
                <div class="info-box">
                    <p>Matrix elements will be scaled according to (A₀/A)^X. This compensates for the dependence of effective interactions on mass number.</p>
                    <p>Set X=0 for no mass-dependent scaling.</p>
                </div>
            </div>

            <div class="section-navigation">
                <button class="prev-tab-btn" data-prev="model-space">Previous: Model Space</button>
                <button class="next-tab-btn" data-next="run-options">Next: Run Options</button>
            </div>
        </div>

        <!-- Run Options Tab -->
        <div id="run-options" class="tab-section">
            <h2>Run Options</h2>
            <p>Define the type of calculation to perform and output details.</p>
            
            <div class="card">
                <div class="card-header">Output File Name</div>
                <div class="form-group">
                    <label for="outputName">Output file name prefix:</label>
                    <input type="text" id="outputName" placeholder="e.g., Mg24run1" value="Mg24run1">
                    <div class="help-text">
                        <p>BIGSTICK will create several files with this prefix:</p>
                        <ul>
                            <li><strong>[prefix].res</strong> - Results file with energies and quantum numbers</li>
                            <li><strong>[prefix].wfn</strong> - Wave function file (binary)</li>
                            <li><strong>[prefix].log</strong> - Log file with calculation details</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Run Type</div>
                <div class="form-group">
                    <label for="runType">Select run type:</label>
                    <select id="runType">
                        <option value="n" selected>Compute spectrum (normal run)</option>
                        <option value="ns">Compute spectrum (suppress eigenvector write-up)</option>
                        <option value="ne">Compute eigenvalues only</option>
                        <option value="d">Compute spectrum + one-body densities</option>
                        <option value="p">Compute spectrum + single-particle occupations</option>
                    </select>
                    <div class="help-text">
                        <p><strong>Standard run (n)</strong>: Computes energy spectrum, J and T values, and writes wave functions to file.</p>
                        <p><strong>Suppress eigenvectors (ns)</strong>: Same as standard, but doesn't write wave functions (saves space).</p>
                        <p><strong>Eigenvalues only (ne)</strong>: Fastest option, just computes energies.</p>
                        <p><strong>Densities (d)</strong>: Computes spectrum plus one-body density matrices (for transitions).</p>
                        <p><strong>Occupations (p)</strong>: Computes spectrum plus single-particle occupations.</p>
                    </div>
                </div>
                
                <div class="example-box">
                    <p><strong>Recommendation for beginners:</strong> Start with a normal run (n) to get the basic energy spectrum.</p>
                </div>
            </div>

            <div class="section-navigation">
                <button class="prev-tab-btn" data-prev="interactions">Previous: Interactions</button>
                <button class="next-tab-btn" data-next="diagonalization">Next: Diagonalization</button>
            </div>
        </div>

        <!-- Diagonalization Tab -->
        <div id="diagonalization" class="tab-section">
            <h2>Diagonalization Options</h2>
            <p>Set parameters for how BIGSTICK will solve the eigenvalue problem.</p>
            
            <div class="example-box">
                <p><strong>Example:</strong> For 24Mg, standard Lanczos with default convergence, keeping 5 states and maximum 150 iterations is usually sufficient.</p>
            </div>
            
            <div class="card">
                <div class="card-header">Diagonalization Method</div>
                <div class="form-group">
                    <label for="diagMethod">Choose diagonalization method:</label>
                    <select id="diagMethod">
                        <option value="ld" selected>Lanczos with default convergence (STANDARD)</option>
                        <option value="lf">Lanczos with fixed iterations</option>
                        <option value="td">Thick-restart Lanczos with default convergence</option>
                        <option value="ex">Exact diagonalization (small dimensions only)</option>
                    </select>
                    <div class="help-text">
                        <p><strong>Standard Lanczos (ld)</strong>: Recommended for most calculations. Iteratively finds the lowest eigenstates.</p>
                        <p><strong>Fixed iterations (lf)</strong>: Runs a fixed number of iterations without checking convergence.</p>
                        <p><strong>Thick-restart (td)</strong>: For very large problems that need less memory.</p>
                        <p><strong>Exact (ex)</strong>: Only for very small dimensions (less than ~10,000).</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Lanczos Parameters</div>
                <div class="form-group">
                    <label for="nKeep">Number of states to keep:</label>
                    <input type="number" id="nKeep" min="1" max="100" value="5">
                    <div class="help-text">
                        <p>Number of low-lying states to compute and print out.</p>
                        <p>Typical values: 5-10 states for ground state plus a few excited states.</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="maxIter">Maximum number of Lanczos iterations:</label>
                    <input type="number" id="maxIter" min="10" max="1000" value="150">
                    <div class="help-text">
                        <p>Maximum number of Lanczos iterations to perform.</p>
                        <p>Typical values: 100-300. For sd-shell nuclei, 150 is usually sufficient.</p>
                        <p>More iterations are needed for:</p>
                        <ul>
                            <li>More states (higher nKeep)</li>
                            <li>Higher precision</li>
                            <li>Closely spaced energy levels</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="section-navigation">
                <button class="prev-tab-btn" data-prev="run-options">Previous: Run Options</button>
                <button class="next-tab-btn" data-next="input-file">Next: Generate Input File</button>
            </div>
        </div>

        <!-- Input File Tab -->
        <div id="input-file" class="tab-section">
            <h2>Generate Input File</h2>
            
            <div class="card">
                <div class="card-header">Your BIGSTICK Configuration</div>
                <p>Review your calculation settings below:</p>
                <div id="summaryList">
                    <!-- Filled dynamically -->
                </div>
            </div>
            
            <button id="generateInputBtn" class="generate-btn">Generate BIGSTICK Input File</button>
            
            <div class="input-preview">
                <h3>Generated Input File</h3>
                <p>This is the input file for your BIGSTICK calculation. You can copy or download it to use with BIGSTICK.</p>
                <div class="code-block" id="generatedInput">
                    <!-- This will be filled dynamically -->
                    <p class="help-text">Click the "Generate BIGSTICK Input File" button above to create your input file.</p>
                </div>
                
                <div class="info-box">
                    <h4>How to use this input file:</h4>
                    <ol>
                        <li>Download the input file to your computer</li>
                        <li>Make sure you have BIGSTICK installed and compiled</li>
                        <li>Run BIGSTICK with this command:</li>
                    </ol>
                    <code>bigstick.x < your_input_file.txt</code>
                </div>
                
                <div class="action-buttons">
                    <button id="copyInputBtn" onclick="copyInputToClipboard()">Copy to Clipboard</button>
                    <a id="downloadInputBtn" href="#" onclick="downloadInputFile(); return false;" download="bigstick_input.txt">Download Input File</a>
                </div>
                
                <div class="card">
                    <div class="card-header">Line-by-Line Explanation</div>
                    <div id="explanationBox">
                        <!-- Filled dynamically -->
                        <p>Generate the input file to see the explanation.</p>
                    </div>
                </div>
            </div>

            <div class="section-navigation">
                <button class="prev-tab-btn" data-prev="diagonalization">Previous: Diagonalization</button>
            </div>
        </div>

        <footer>
            <p>Designed and made by <a href="http://jinlei.fewbody.com/">Jin Lei</a>. Supported by the National Natural Science Foundation of China (Grants No. 12475132). If you find any bugs or errors related to this website, please <a href="mailto:jinl@tongji.edu.cn">email me</a>.</p>
        </footer>
    </div>

    <script>
        // Tab navigation
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Hide all tab sections
                document.querySelectorAll('.tab-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show selected tab section
                document.getElementById(tabId).classList.add('active');
                
                // Update active button
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
            });
        });
        
        // Next/Previous tab navigation
        document.querySelectorAll('.next-tab-btn').forEach(button => {
            button.addEventListener('click', function() {
                const nextTabId = this.getAttribute('data-next');
                document.querySelector(`.tab-button[data-tab="${nextTabId}"]`).click();
            });
        });
        
        document.querySelectorAll('.prev-tab-btn').forEach(button => {
            button.addEventListener('click', function() {
                const prevTabId = this.getAttribute('data-prev');
                document.querySelector(`.tab-button[data-tab="${prevTabId}"]`).click();
            });
        });
        
        // Show/hide auto options
        document.getElementById('spsFileChoice').addEventListener('change', function() {
            if (this.value === 'auto') {
                document.getElementById('autoOptions').style.display = 'block';
            } else {
                document.getElementById('autoOptions').style.display = 'none';
            }
        });
        
        // Show/hide truncation options
        document.querySelectorAll('input[name="truncate"]').forEach(input => {
            input.addEventListener('change', function() {
                if (this.value === 'y') {
                    document.getElementById('truncationOptions').style.display = 'block';
                } else {
                    document.getElementById('truncationOptions').style.display = 'none';
                }
            });
        });
        
        // Handle pre-defined nuclei selection
        document.getElementById('nucleus').addEventListener('change', function() {
            if (this.value === 'custom') {
                return; // Let user set custom values
            }
            
            // Set values based on selected nucleus
            const nucleiData = {
                'mg24': { sps: 'sd', protons: 4, neutrons: 4, jz: 0, parity: '+', int: 'usdb', a0: 18, a: 24 },
                'si28': { sps: 'sd', protons: 6, neutrons: 6, jz: 0, parity: '+', int: 'usdb', a0: 18, a: 28 },
                's32': { sps: 'sd', protons: 8, neutrons: 8, jz: 0, parity: '+', int: 'usdb', a0: 18, a: 32 },
                'ca40': { sps: 'sd', protons: 12, neutrons: 12, jz: 0, parity: '+', int: 'usdb', a0: 18, a: 40 },
                'ca48': { sps: 'pf', protons: 0, neutrons: 8, jz: 0, parity: '+', int: 'gxpf1a', a0: 42, a: 48 },
                'ti46': { sps: 'pf', protons: 2, neutrons: 4, jz: 0, parity: '+', int: 'gxpf1a', a0: 42, a: 46 },
                'fe56': { sps: 'pf', protons: 6, neutrons: 10, jz: 0, parity: '+', int: 'gxpf1a', a0: 42, a: 56 },
                'ni56': { sps: 'pf', protons: 8, neutrons: 8, jz: 0, parity: '+', int: 'kb3g', a0: 42, a: 56 }
            };
            
            const data = nucleiData[this.value];
            
            // Set values in form
            document.getElementById('spsFileChoice').value = data.sps;
            document.getElementById('valenceProtons').value = data.protons;
            document.getElementById('valenceNeutrons').value = data.neutrons;
            document.getElementById('jzValue').value = data.jz;
            document.getElementById('intFile').value = data.int;
            document.getElementById('scaleB').value = data.a0;
            document.getElementById('targetA').value = data.a;
            document.getElementById('outputName').value = this.value + 'run1';
            
            // Set parity
            document.querySelectorAll('input[name="parity"]').forEach(radio => {
                if (radio.value === data.parity) {
                    radio.checked = true;
                }
            });
        });
        
        // Function to generate a summary of settings
        function updateSummary() {
            const summaryList = document.getElementById('summaryList');
            
            // Model Space
            const spsFile = document.getElementById('spsFileChoice').value;
            const spsText = document.getElementById('spsFileChoice').options[document.getElementById('spsFileChoice').selectedIndex].text;
            const valenceP = document.getElementById('valenceProtons').value;
            const valenceN = document.getElementById('valenceNeutrons').value;
            const jzVal = document.getElementById('jzValue').value;
            
            // Get parity
            const parityOptions = document.querySelectorAll('input[name="parity"]');
            let parity = "+";
            for (const option of parityOptions) {
                if (option.checked) {
                    parity = option.value;
                    break;
                }
            }
            
            // Interaction
            const intFile = document.getElementById('intFile').value;
            const intText = document.getElementById('intFile').options[document.getElementById('intFile').selectedIndex].text;
            
            // Run type
            const runType = document.getElementById('runType').value;
            const runTypeText = document.getElementById('runType').options[document.getElementById('runType').selectedIndex].text;
            
            // Diagonalization
            const diagMethod = document.getElementById('diagMethod').value;
            const diagMethodText = document.getElementById('diagMethod').options[document.getElementById('diagMethod').selectedIndex].text;
            const nKeep = document.getElementById('nKeep').value;
            const maxIter = document.getElementById('maxIter').value;
            
            // Build HTML
            let summaryHTML = `
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tr>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Setting</th>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Value</th>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Single-particle space</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${spsText}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Valence particles</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${valenceP} protons, ${valenceN} neutrons</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">2 × Jz</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${jzVal}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Parity</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${parity}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Interaction</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${intText}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Run type</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${runTypeText}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Diagonalization</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${diagMethodText}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">States to keep</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${nKeep}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Max iterations</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${maxIter}</td>
                    </tr>
                </table>
            `;
            
            summaryList.innerHTML = summaryHTML;
        }
        
        // Function to generate input file based on current settings
        function generateInputFile() {
            // Get values from form fields
            const runType = document.getElementById('runType').value;
            const outputName = document.getElementById('outputName').value || "bigstick_output";
            const spsFile = document.getElementById('spsFileChoice').value;
            
            // Handle auto option for NCSM
            let spsFileValue = spsFile;
            if (spsFile === 'auto') {
                const maxN = document.getElementById('maxN').value;
                spsFileValue = `auto\n${maxN}`;
            }
            
            const valenceP = document.getElementById('valenceProtons').value;
            const valenceN = document.getElementById('valenceNeutrons').value;
            const jzVal = document.getElementById('jzValue').value;
            
            // Get parity
            const parityOptions = document.querySelectorAll('input[name="parity"]');
            let parity = "+";
            for (const option of parityOptions) {
                if (option.checked) {
                    parity = option.value;
                    break;
                }
            }
            
            // Get truncation settings
            const truncateOptions = document.querySelectorAll('input[name="truncate"]');
            let truncate = "n";
            for (const option of truncateOptions) {
                if (option.checked) {
                    truncate = option.value;
                    break;
                }
            }
            
            // Get interaction file
            const intFile = document.getElementById('intFile').value;
            
            // Get scaling values
            const scaleA = document.getElementById('scaleA').value;
            const scaleB = document.getElementById('scaleB').value;
            const targetA = document.getElementById('targetA').value;
            const scaleX = document.getElementById('scaleX').value;
            
            // Get diagonalization settings
            const diagMethod = document.getElementById('diagMethod').value;
            const nKeep = document.getElementById('nKeep').value;
            const maxIter = document.getElementById('maxIter').value;
            
            // Construct input file
            let inputFile = `${runType}\n${outputName}\n${spsFileValue}\n${valenceP} ${valenceN}\n${jzVal}\n`;
            
            // Add parity if needed (not for sd shell which is all positive)
            if (spsFile !== 'sd') {
                inputFile += `${parity}\n`;
            }
            
            // Add truncation info
            inputFile += `${truncate}\n`;
            if (truncate === 'y') {
                const maxExcite = document.getElementById('maxExcite').value;
                inputFile += `${maxExcite}\n`;
            }
            
            // Add interaction files
            inputFile += `${intFile}\n`;
            
            // Add scaling
            inputFile += `${scaleA} ${scaleB} ${targetA} ${scaleX}\n`;
            
            // Add end of interaction marker
            inputFile += "end\n";
            
            // Add diagonalization method
            inputFile += `${diagMethod}\n${nKeep} ${maxIter}\n`;
            
            // Add final blank line
            inputFile += "\n";
            
            return inputFile;
        }
        
        // Generate line-by-line explanation
        function generateExplanation() {
            const runType = document.getElementById('runType').value;
            const outputName = document.getElementById('outputName').value || "bigstick_output";
            const spsFile = document.getElementById('spsFileChoice').value;
            const valenceP = document.getElementById('valenceProtons').value;
            const valenceN = document.getElementById('valenceNeutrons').value;
            const jzVal = document.getElementById('jzValue').value;
            const intFile = document.getElementById('intFile').value;
            const scaleA = document.getElementById('scaleA').value;
            const scaleB = document.getElementById('scaleB').value;
            const targetA = document.getElementById('targetA').value;
            const scaleX = document.getElementById('scaleX').value;
            const diagMethod = document.getElementById('diagMethod').value;
            const nKeep = document.getElementById('nKeep').value;
            const maxIter = document.getElementById('maxIter').value;
            
            // Get run type explanation
            let runTypeExplanation = "";
            switch(runType) {
                case 'n': runTypeExplanation = "Normal run, computing spectrum and wave functions"; break;
                case 'ns': runTypeExplanation = "Compute spectrum (suppress eigenvector write-up)"; break;
                case 'ne': runTypeExplanation = "Compute eigenvalues only"; break;
                case 'd': runTypeExplanation = "Compute spectrum + all one-body densities"; break;
                case 'p': runTypeExplanation = "Compute spectrum + single-particle occupations"; break;
                default: runTypeExplanation = "Run type code";
            }
            
            // Get diagonalization explanation
            let diagExplanation = "";
            switch(diagMethod) {
                case 'ld': diagExplanation = "Lanczos with default convergence"; break;
                case 'lf': diagExplanation = "Lanczos with fixed iterations"; break;
                case 'td': diagExplanation = "Thick-restart Lanczos with default convergence"; break;
                case 'ex': diagExplanation = "Exact and full diagonalization"; break;
                default: diagExplanation = "Diagonalization method";
            }
            
            let explanation = `
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tr>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Line</th>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Value</th>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Explanation</th>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">1</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${runType}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${runTypeExplanation}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">2</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${outputName}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Output file name prefix</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">3</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${spsFile}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Single-particle space file/definition</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">4</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${valenceP} ${valenceN}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Number of valence protons and neutrons</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">5</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${jzVal}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">2 × Jz value</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">6</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>n</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">No truncation (or "y" for truncation)</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">7</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${intFile}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Interaction file</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">8</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${scaleA} ${scaleB} ${targetA} ${scaleX}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Scaling parameters: SPEs, A₀, A, exponent</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">9</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>end</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">End of interaction file input</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">10</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${diagMethod}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">${diagExplanation}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">11</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>${nKeep} ${maxIter}</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Number of states to keep, maximum iterations</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">12</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;"><code>(empty line)</code></td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee;">Required blank line at end of input file</td>
                    </tr>
                </table>
            `;
            
            return explanation;
        }
        
        // Function to update displayed input file and explanation
        function updateInputDisplay() {
            const inputText = generateInputFile();
            document.getElementById('generatedInput').innerHTML = inputText.trim(); // Trim to not show the trailing newline
            document.getElementById('explanationBox').innerHTML = generateExplanation();
        }
        
        // Function to copy input to clipboard
        function copyInputToClipboard() {
            const inputText = generateInputFile();
            navigator.clipboard.writeText(inputText)
                .then(() => {
                    alert("Input file copied to clipboard!");
                })
                .catch(err => {
                    console.error('Error copying text: ', err);
                    alert("Failed to copy. Please select and copy the text manually.");
                });
        }
        
        // Function to download input file
        function downloadInputFile() {
            const inputText = generateInputFile();
            const element = document.createElement('a');
            const file = new Blob([inputText], {type: 'text/plain'});
            element.href = URL.createObjectURL(file);
            element.download = "bigstick_input.txt";
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }
        
        // Generate input file button
        document.getElementById('generateInputBtn').addEventListener('click', function() {
            updateSummary();
            updateInputDisplay();
        });
        
        // Initialize interface with default values for 24Mg
        window.onload = function() {
            // Set initial values for 24Mg example
            document.getElementById('spsFileChoice').value = 'sd';
            document.getElementById('valenceProtons').value = '4';
            document.getElementById('valenceNeutrons').value = '4';
            document.getElementById('jzValue').value = '0';
            document.getElementById('intFile').value = 'usdb';
            document.getElementById('scaleA').value = '1.0';
            document.getElementById('scaleB').value = '18';
            document.getElementById('targetA').value = '24';
            document.getElementById('scaleX').value = '0.3';
            document.getElementById('outputName').value = 'Mg24run1';
        };
    </script>
</body>
</html>